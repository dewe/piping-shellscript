#!/bin/sh
set -eu

usage() {
    cat >&2 << 'EOF'
Usage: slug [options]

Slugify input from stdin to stdout

Options:
  -h, --help    Show this help message

Examples:
  echo 'Hello World!' | slug
  slug < input.txt
EOF
}

slugify() {
    printf '%s\n' "$1" | 
    tr '[:upper:]' '[:lower:]' | 
    tr -c '[:alnum:]\n' '-' | 
    sed 's/--*/-/g' | 
    sed 's/^-*//' | 
    sed 's/-*$//'
}

main() {
    # Check for help flags
    if [ $# -gt 0 ]; then
        case "$1" in
            -h|--help)
                usage
                exit 0
                ;;
        esac
    fi

    # Validate input source
    if [ -t 0 ]; then
        usage;
        exit 1
    fi

    # Check if there's any input
    if ! IFS= read -r first_line; then
        usage;
        exit 1
    fi

    slugify "$first_line"

    while IFS= read -r line || [ -n "$line" ]; do
        slugify "$line"
    done
}

main "$@"